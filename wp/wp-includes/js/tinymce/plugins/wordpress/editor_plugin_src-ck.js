/**
 * WordPress plugin.
 */(function(){var e=tinymce.DOM;tinymce.create("tinymce.plugins.WordPress",{init:function(t,n){var r=this,i=t.getParam("wordpress_adv_toolbar","toolbar2"),s=0,o,u,a,f;o='<img src="'+n+'/img/trans.gif" class="mceWPmore mceItemNoResize" title="'+t.getLang("wordpress.wp_more_alt")+'" />';u='<img src="'+n+'/img/trans.gif" class="mceWPnextpage mceItemNoResize" title="'+t.getLang("wordpress.wp_page_alt")+'" />';getUserSetting("hidetb","0")=="1"&&(t.settings.wordpress_adv_hidden=0);t.onPostRender.add(function(){var n=t.controlManager.get(i);if(t.getParam("wordpress_adv_hidden",1)&&n){e.hide(n.id);r._resizeIframe(t,i,28)}});t.addCommand("WP_More",function(){t.execCommand("mceInsertContent",0,o)});t.addCommand("WP_Page",function(){t.execCommand("mceInsertContent",0,u)});t.addCommand("WP_Help",function(){t.windowManager.open({url:tinymce.baseURL+"/wp-mce-help.php",width:450,height:420,inline:1})});t.addCommand("WP_Adv",function(){var n=t.controlManager,s=n.get(i).id;if("undefined"==s)return;if(e.isHidden(s)){n.setActive("wp_adv",1);e.show(s);r._resizeIframe(t,i,-28);t.settings.wordpress_adv_hidden=0;setUserSetting("hidetb","1")}else{n.setActive("wp_adv",0);e.hide(s);r._resizeIframe(t,i,28);t.settings.wordpress_adv_hidden=1;setUserSetting("hidetb","0")}});t.addCommand("WP_Medialib",function(){typeof wp!="undefined"&&wp.media&&wp.media.editor&&wp.media.editor.open(t.id)});t.addButton("wp_more",{title:"wordpress.wp_more_desc",cmd:"WP_More"});t.addButton("wp_page",{title:"wordpress.wp_page_desc",image:n+"/img/page.gif",cmd:"WP_Page"});t.addButton("wp_help",{title:"wordpress.wp_help_desc",cmd:"WP_Help"});t.addButton("wp_adv",{title:"wordpress.wp_adv_desc",cmd:"WP_Adv"});t.addButton("add_media",{title:"wordpress.add_media",image:n+"/img/image.gif",cmd:"WP_Medialib"});t.onBeforeExecCommand.add(function(e,t,n,r,i){var s=tinymce.DOM,o,u,a,f,l,c;"mceFullScreen"==t&&"mce_fullscreen"!=e.id&&s.select("a.thickbox").length&&(e.settings.theme_advanced_buttons1+=",|,add_media");if("JustifyLeft"==t||"JustifyRight"==t||"JustifyCenter"==t){o=e.selection.getNode();if(o.nodeName=="IMG"){c=t.substr(7).toLowerCase();l="align"+c;u=e.dom.getParent(o,"dl.wp-caption");a=e.dom.getParent(o,"div.mceTemp");if(u&&a){f=e.dom.hasClass(u,l)?"alignnone":l;u.className=u.className.replace(/align[^ '"]+\s?/g,"");e.dom.addClass(u,f);f=="aligncenter"?e.dom.addClass(a,"mceIEcenter"):e.dom.removeClass(a,"mceIEcenter");i.terminate=!0;e.execCommand("mceRepaint")}else e.dom.hasClass(o,l)?e.dom.addClass(o,"alignnone"):e.dom.removeClass(o,"alignnone")}}});t.onInit.add(function(e){var t=e.getParam("body_class",""),n=e.getBody();t?t=t.split(" "):t=[];e.getParam("directionality","")=="rtl"&&t.push("rtl");tinymce.isIE9?t.push("ie9"):tinymce.isIE8?t.push("ie8"):tinymce.isIE7&&t.push("ie7");e.id!="wp_mce_fullscreen"&&e.id!="mce_fullscreen"?t.push("wp-editor"):e.id=="mce_fullscreen"&&t.push("mce-fullscreen");tinymce.each(t,function(t){t&&e.dom.addClass(n,t)});e.onNodeChange.add(function(e,t,n){var r;if(n.nodeName=="IMG")r=e.dom.getParent(n,"dl.wp-caption");else if(n.nodeName=="DIV"&&e.dom.hasClass(n,"mceTemp")){r=n.firstChild;e.dom.hasClass(r,"wp-caption")||(r=!1)}r&&(e.dom.hasClass(r,"alignleft")?t.setActive("justifyleft",1):e.dom.hasClass(r,"alignright")?t.setActive("justifyright",1):e.dom.hasClass(r,"aligncenter")&&t.setActive("justifycenter",1))});e.onBeforeSetContent.add(function(e,t){if(t.content){t.content=t.content.replace(/<p>\s*<(p|div|ul|ol|dl|table|blockquote|h[1-6]|fieldset|pre|address)( [^>]*)?>/gi,"<$1$2>");t.content=t.content.replace(/<\/(p|div|ul|ol|dl|table|blockquote|h[1-6]|fieldset|pre|address)>\s*<\/p>/gi,"</$1>")}})});"undefined"!=typeof jQuery&&t.onKeyUp.add(function(e,t){var n=t.keyCode||t.charCode;if(n==s)return;(13==n||8==s||46==s)&&jQuery(document).triggerHandler("wpcountwords",[e.getContent({format:"raw"})]);s=n});t.onSaveContent.addToTop(function(e,t){t.content=t.content.replace(/<p>(<br ?\/?>|\u00a0|\uFEFF)?<\/p>/g,"<p>&nbsp;</p>")});t.onSaveContent.add(function(e,t){e.getParam("wpautop",!0)&&typeof switchEditors=="object"&&(e.isHidden()?t.content=t.element.value:t.content=switchEditors.pre_wpautop(t.content))});r._handleMoreBreak(t,n);f="alt+shift";t.addShortcut(f+"+c","justifycenter_desc","JustifyCenter");t.addShortcut(f+"+r","justifyright_desc","JustifyRight");t.addShortcut(f+"+l","justifyleft_desc","JustifyLeft");t.addShortcut(f+"+j","justifyfull_desc","JustifyFull");t.addShortcut(f+"+q","blockquote_desc","mceBlockQuote");t.addShortcut(f+"+u","bullist_desc","InsertUnorderedList");t.addShortcut(f+"+o","numlist_desc","InsertOrderedList");t.addShortcut(f+"+n","spellchecker.desc","mceSpellCheck");t.addShortcut(f+"+a","link_desc","WP_Link");t.addShortcut(f+"+s","unlink_desc","unlink");t.addShortcut(f+"+m","image_desc","WP_Medialib");t.addShortcut(f+"+z","wordpress.wp_adv_desc","WP_Adv");t.addShortcut(f+"+t","wordpress.wp_more_desc","WP_More");t.addShortcut(f+"+d","striketrough_desc","Strikethrough");t.addShortcut(f+"+h","help_desc","WP_Help");t.addShortcut(f+"+p","wordpress.wp_page_desc","WP_Page");t.addShortcut("ctrl+s","save_desc",function(){"function"==typeof autosave&&autosave()});/\bwpfullscreen\b/.test(t.settings.plugins)?t.addShortcut(f+"+w","wordpress.wp_fullscreen_desc","wpFullScreen"):/\bfullscreen\b/.test(t.settings.plugins)&&t.addShortcut(f+"+g","fullscreen.desc","mceFullScreen");t.onInit.add(function(e){tinymce.dom.Event.add(e.getWin(),"scroll",function(t){e.plugins.wordpress._hideButtons()});tinymce.dom.Event.add(e.getBody(),"dragstart",function(t){e.plugins.wordpress._hideButtons()})});t.onBeforeExecCommand.add(function(e,t,n,r){e.plugins.wordpress._hideButtons()});t.onSaveContent.add(function(e,t){e.plugins.wordpress._hideButtons()});t.onMouseDown.add(function(e,t){t.target.nodeName!="IMG"&&e.plugins.wordpress._hideButtons()});t.onKeyDown.add(function(e,t){(t.which==tinymce.VK.DELETE||t.which==tinymce.VK.BACKSPACE)&&e.plugins.wordpress._hideButtons()});a=function(e){var n;if(e.target.id=="mceModalBlocker"||e.target.className=="ui-widget-overlay")for(n in t.windowManager.windows)t.windowManager.close(null,n)};tinymce.dom.Event.remove(document.body,"click",a);tinymce.dom.Event.add(document.body,"click",a)},getInfo:function(){return{longname:"WordPress Plugin",author:"WordPress",authorurl:"http://wordpress.org",infourl:"http://wordpress.org",version:"3.0"}},_setEmbed:function(e){return e.replace(/\[embed\]([\s\S]+?)\[\/embed\][\s\u00a0]*/g,function(e,t){return'<img width="300" height="200" src="'+tinymce.baseURL+'/plugins/wordpress/img/trans.gif" class="wp-oembed mceItemNoResize" alt="'+t+'" title="'+t+'" />'})},_getEmbed:function(e){return e.replace(/<img[^>]+>/g,function(e){if(e.indexOf('class="wp-oembed')!=-1){var t=e.match(/alt="([^\"]+)"/);t[1]&&(e="[embed]"+t[1]+"[/embed]")}return e})},_showButtons:function(e,t){var n=tinyMCE.activeEditor,r,i,s,o=tinymce.DOM,u,a;s=n.dom.getViewPort(n.getWin());r=o.getPos(n.getContentAreaContainer());i=n.dom.getPos(e);u=Math.max(i.x-s.x,0)+r.x;a=Math.max(i.y-s.y,0)+r.y;o.setStyles(t,{top:a+5+"px",left:u+5+"px",display:"block"})},_hideButtons:function(){var e=tinymce.DOM;e.hide(e.select("#wp_editbtns, #wp_gallerybtns"))},_resizeIframe:function(t,n,r){var i=t.getContentAreaContainer().firstChild;e.setStyle(i,"height",i.clientHeight+r);t.theme.deltaHeight+=r},_handleMoreBreak:function(e,t){var n,r;n='<img src="'+t+'/img/trans.gif" alt="$1" class="mceWPmore mceItemNoResize" title="'+e.getLang("wordpress.wp_more_alt")+'" />';r='<img src="'+t+'/img/trans.gif" class="mceWPnextpage mceItemNoResize" title="'+e.getLang("wordpress.wp_page_alt")+'" />';e.onPostRender.add(function(){e.theme.onResolveName&&e.theme.onResolveName.add(function(t,n){if(n.node.nodeName=="IMG"){e.dom.hasClass(n.node,"mceWPmore")&&(n.name="wpmore");e.dom.hasClass(n.node,"mceWPnextpage")&&(n.name="wppage")}})});e.onBeforeSetContent.add(function(e,t){if(t.content){t.content=t.content.replace(/<!--more(.*?)-->/g,n);t.content=t.content.replace(/<!--nextpage-->/g,r)}});e.onPostProcess.add(function(e,t){t.get&&(t.content=t.content.replace(/<img[^>]+>/g,function(e){if(e.indexOf('class="mceWPmore')!==-1){var t,n=(t=e.match(/alt="(.*?)"/))?t[1]:"";e="<!--more"+n+"-->"}e.indexOf('class="mceWPnextpage')!==-1&&(e="<!--nextpage-->");return e}))});e.onNodeChange.add(function(e,t,n){t.setActive("wp_page",n.nodeName==="IMG"&&e.dom.hasClass(n,"mceWPnextpage"));t.setActive("wp_more",n.nodeName==="IMG"&&e.dom.hasClass(n,"mceWPmore"))})}});tinymce.PluginManager.add("wordpress",tinymce.plugins.WordPress)})();